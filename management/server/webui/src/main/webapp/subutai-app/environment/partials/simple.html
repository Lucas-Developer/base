<div ng-controller="EnvironmentSimpleViewCtrl as environmentSimpleViewCtrl"
         ng-init="environmentSimpleViewCtrl.loadPrivateTemplates()" class="b-workspace__environments">

  <div class="b-workspace__header b-workspace__header_cloud-env">

    <div class="b-switcher">
      <div class="b-toggle b-toggle_cloud">
        <input type="checkbox"
               class="b-check"
               ng-model="environmentMode"
               ng-change="environmentSimpleViewCtrl.changeMode(environmentMode)">

        <div class="b-toggle-bg"></div>
        <b class="b-b b-switch"></b>
      </div>
    </div>

  </div>
  <div class="b-workspace__content b-workspace__content_cloud-env">
    <div class="b-cloud">
      <div class="b-cloud__tools g-right">
        <div class="b-cloud-tools">
          <div class="b-tabs-menu b-tabs-menu_cloud-env">
            <ul>
              <li class="b-tabs-menu__item b-tabs-menu__item_active"
                  style="width: 100%"
                  ng-click="environmentSimpleViewCtrl.activeCloudTab = 'templates'"
                  ng-class="environmentSimpleViewCtrl.activeCloudTab == 'templates' ? 'b-tabs-menu__item_active' : ''">
                Templates
              </li>
            </ul>
          </div>
          <div class="b-tools-menu js-scrollbar">
            <div class="b-tools-menu__inpit">
              <input type="text" class="b-search-input" ng-model="searchTemplate" ng-init="searchTemplate=''"
                     id="js-search"
                     placeholder="Search...">
            </div>
            <div class="b-tools-menu__inpit">
              <select class="b-search-input" ng-model="environmentSimpleViewCtrl.templatesType"
                      ng-change="environmentSimpleViewCtrl.getFilteredTemplates()">
                <option value="all">All</option>
                <option ng-repeat="(templatesType, templateList) in environmentSimpleViewCtrl.templates"
                        value="{{ templatesType }}">
                  {{ templatesType }} ({{ templateList.length }})
                </option>
              </select>
            </div>
            <ul>
              <li ng-repeat="template in environmentSimpleViewCtrl.templatesList | filter:{'name' : searchTemplate} | orderBy: 'name' track by $index">
						<span class="b-tools-menu__item"
                  ng-click="environmentSimpleViewCtrl.addContainer(template.name, $event, null, null, template.id)"
                  title="Version: {{ template.version }} Size: {{ environmentSimpleViewCtrl.humanFileSize(template.size, true) }} Parent: {{ template.parent }} Owners: {{template.owner}}">
							<span class="b-cloud-item">
								<img
                    ng-src="assets/templates/{{ template.name }}.jpg"
                    alt="{{ template.name }}"
                    on-error-src="assets/templates/no-image.jpg">
							</span>
							<span class="b-cloud-item-text">{{ template.name }}</span>
						</span>
              </li>
            </ul>
            <div style="height: 46px;"></div>
          </div>
        </div>
      </div>
      <div class="b-cloud__space">
        <div class="b-cloud-space b-cloud-space_border-right">
          <div class="b-cloud-space__work">
            <div
                class="b-cloud-space-work"
                id="js-environment-creation"
                ng-init="environmentSimpleViewCtrl.initJointJs()">

              <div class="b-environments-plugin js-no-close">
						<span class="b-icon b-icon_plugins b-icon_30 js-call-plugins-popup"
                  tooltips
                  tooltip-side="right"
                  tooltip-template='Plugins'>
						</span>
                <div class="b-template-settings b-template-settings_plugins js-environment-plugins-menu">
                  <div class="header">Choose plugin</div>
                  <div class="b-template-settings__body">
                    <div class="b-environments-plugin__list js-scrollbar js-pluginspopup-scroll">
                      <ul class="b-environments-plugin-list">
                        <li class="b-environments-plugin-list__item"
                            ng-repeat="plugin in environmentSimpleViewCtrl.filteredPlugins">
                          <a ui-sref="{{ plugin.name.toLowerCase() }}"
                             class="b-cloud-item-link b-btn b-btn_white">goto</a>
                          <span class="b-tools-menu__item"
                                ng-click="environmentSimpleViewCtrl.selectPlugin(plugin)">

												<i class="fa b-cloud-item-checkbox"
                           aria-hidden="true"
                           ng-class="plugin.selected ? 'fa-check-square-o' : 'fa-square-o'">
												</i>

												<span class="b-cloud-item">
													<img
                              ng-src="/{{ plugin.img }}"
                              alt="{{ plugin.name }}"
                              onError="this.onerror=null;this.src='assets/templates/no-image.jpg';">
												</span>

												<span class="b-cloud-item-text">{{ plugin.name }}</span>

											</span>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="footer">

                    <button type="button"
                            class="b-btn b-btn_green"
                            ng-click="environmentSimpleViewCtrl.setTemplatesByPlugin()"
                            ng-disabled="environmentSimpleViewCtrl.filteredPlugins | isEmpty:environmentSimpleViewCtrl.isEditing ">
                      Use
                    </button>

                  </div>
                </div>
              </div>

              <div class="b-template-settings js-dropen-menu js-no-close">
                <div class="header"></div>
                <div class="b-template-settings__coll">
                  <form
                      ng-submit="environmentSimpleViewCtrl.addSettingsToTemplate(templateSettings, environmentSimpleViewCtrl.containersTypeInfo[templateSettings.quotaSize])">
                    <div class="body">
                      <div class="b-form-group">
                        <div class="b-form-group__label">Container hostname</div>
                        <input type="text" ng-focus="onTextFocus($event)"
                               id="js-container-name"
                               class="b-form-input b-form-input_full"
                               ng-model="templateSettings.containerName" required>
                      </div>
                      <div class="b-form-group">
                        <div class="b-form-group__label">Select quota size</div>
                        <select class="b-form-input b-form-input_full"
                                id="js-container-size"
                                ng-init="templateSettings.quotaSize = 'SMALL'"
                                ng-model="templateSettings.quotaSize"
                        >
                          <option
                              ng-repeat="type in environmentSimpleViewCtrl.containersType"
                              value="{{ type }}" title="{{ environmentSimpleViewCtrl.containersTypeInfo[type] }}">
                            {{ type }}
                          </option>
                        </select>
                      </div>
                    </div>
                    <div class="footer">
                      <button type="submit" class="b-btn b-btn_green">Save</button>
                    </div>
                  </form>
                </div>
                <div class="b-template-settings__coll" ng-if="templateSettings.quotaSize !== 'CUSTOM'">
                  <p class="b-template-settings__text">
                    {{ templateSettings.quotaSize }}: <br>
                    <span
                        ng-repeat="(key, value) in environmentSimpleViewCtrl.containersTypeInfo[templateSettings.quotaSize]">
									{{ key }}: {{ value }}<br>
								</span>
                  </p>
                </div>
                <!--CUSTOM-->
                <div class="b-template-settings__coll b-template-settings__coll_quota"
                     ng-if="templateSettings.quotaSize == 'CUSTOM'">
                  <p class="b-template-settings__text">CUSTOM:</p>
                  <div class="b-template-settings__text b-template-settings__text_input">
                    <label for="js-quotasize-custom-cpu" class="b-form-label b-form-label_margin_r">cpu (%):</label>
                    <input type="number"
                           id="js-quotasize-custom-cpu"
                           class="b-form-input b-form-input_custom-quota"
                           ng-model="templateSettings.cpuQuota" required>
                    <div class="clear"></div>
                  </div>
                  <div class="b-template-settings__text b-template-settings__text_input">
                    <label for="js-quotasize-custom-ram" class="b-form-label b-form-label_margin_r">ram (MB):</label>
                    <input type="number"
                           id="js-quotasize-custom-ram"
                           class="b-form-input b-form-input_custom-quota"
                           ng-model="templateSettings.ramQuota" required>
                    <div class="clear"></div>
                  </div>
                  <div class="b-template-settings__text b-template-settings__text_input">
                    <label for="js-quotasize-custom-disk" class="b-form-label b-form-label_margin_r">disk (GB):</label>
                    <input type="number"
                           id="js-quotasize-custom-disk"
                           class="b-form-input b-form-input_custom-quota"
                           ng-model="templateSettings.diskQuota" required>
                    <div class="clear"></div>
                  </div>
                </div>
                <!--CUSTOM-->
              </div>

            </div>
            <div class="b-cloud-create-buttons">
              <button class="b-btn b-btn_white"
                      ng-click="environmentSimpleViewCtrl.clearWorkspace()">
                Clear
              </button>
              <button
                  class="b-btn b-btn_green"
                  ng-if="!environmentSimpleViewCtrl.isEditing"
                  ng-click="environmentSimpleViewCtrl.buildEnvironmentByJoint()">
                Apply
              </button>
              <button
                  class="b-btn b-btn_green"
                  ng-if="environmentSimpleViewCtrl.isEditing"
                  ng-click="environmentSimpleViewCtrl.notifyChanges()">
                Apply
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>